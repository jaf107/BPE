<!-- templates/update_corpus.html -->
{% extends 'base.html' %} {% block title %}Update Corpus - BPE Playground{%
endblock %} {% block content %}
<header class="bg-dark text-white text-center py-3">
  <h1 class="mb-0">BPE Playground</h1>
  <nav>
    <ul class="list-unstyled d-flex justify-content-center">
      <li class="mr-3"><a href="/" class="text-white">Home</a></li>
      <li><a href="/update-corpus" class="text-white">Update Corpus</a></li>
    </ul>
  </nav>
</header>

<div class="container my-4">
  <div class="text-center mb-4">
    <button id="update-corpus-button" class="btn btn-primary">
      Update Corpus
    </button>
  </div>

  <div class="row">
    <div class="col-md-12">
      <label for="editor">Corpus:</label>
      <textarea
        id="editor"
        class="form-control"
        placeholder="Enter corpus here..."
        rows="15"
      ></textarea>
    </div>
  </div>
</div>

<footer class="bg-dark text-white text-center py-3 mt-4">
  &copy; 2023 BPE Playground. All rights reserved.
</footer>
<!-- Success Modal -->
<div class="modal" id="successModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Success!</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">Corpus updated successfully.</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Error Modal -->
<div class="modal" id="errorModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Error!</h5>
        <button type="button" class="close" onclick="">
          <span aria-hidden="true">&times;</span>
        </button>
        <div class="modal-body">
          There was an error updating the corpus. Please try again.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document
      .getElementById("update-corpus-button")
      .addEventListener("click", function () {
        updateCorpus();
      });

    function updateCorpus() {
      // Get the corpus from the editor
      var corpus = document.getElementById("editor").value;

      if (!corpus.trim()) {
        // Show error modal for empty corpus
        $("#errorModal").modal("show");
        return; // Stop execution if corpus is empty
      }

      // Send the corpus to the server (you need to implement this endpoint in your Flask app)
      fetch("/update_corpus_action", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ corpus: corpus }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.message) {
            // Show success modal
            $("#successModal").modal("show");
          } else {
            // Show error modal
            $("#errorModal").modal("show");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          // Show error modal in case of a fetch error
          $("#errorModal").modal("show");
        });
    }
  </script>
  {% endblock %}
</div>
